<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <title>Mahdawiyyah Chat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background-color: #F3F4F6;
            font-family: 'Inter', 'Noto Sans', sans-serif;
            display: flex;
            flex-direction: column;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            background-color: #556B2F;
            padding: 0.8rem;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        header h1 {
            color: #FFFFFF;
            font-size: 1.3rem;
            font-weight: 700;
            text-align: center;
        }

        .back-btn, .send-btn {
            background: none;
            border: none;
            color: #FFFFFF;
            font-size: 1.5rem;
            cursor: pointer;
            position: absolute;
            left: 0.8rem;
        }

        .send-btn {
            position: static;
            color: #556B2F;
        }

        main {
            flex: 1;
            padding: 0.3rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }

        .message {
            display: flex;
            max-width: 100%;
            align-items: flex-end;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message.bot {
            justify-content: flex-start;
        }

        .avatar {
            width: 1.8rem;
            height: 1.8rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 0.2rem;
            flex-shrink: 0;
        }

        .message.bot .avatar {
            background-color: #E8F5E9;
            color: #556B2F;
        }

        .message.user .avatar {
            background-color: #F1F8E9;
            color: #556B2F;
            order: 1;
        }

        .message-content {
            display: flex;
            flex-direction: column;
            max-width: 60%;
        }

        .sender {
            font-size: 0.75rem;
            color: #6B7280;
            font-weight: 500;
            padding: 0.2rem;
        }

        .message.user .sender {
            text-align: right;
        }

        .message-bubble {
            padding: 0.5rem 0.7rem;
            border-radius: 1.2rem;
            font-size: 0.95rem;
            line-height: 1.4;
            word-wrap: break-word;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .message.bot .message-bubble {
            background-color: #FFFFFF;
            color: #374151;
            border-bottom-left-radius: 0.3rem;
        }

        .message.user .message-bubble {
            background-color: #556B2F;
            color: #FFFFFF;
            border-bottom-right-radius: 0.3rem;
        }

        footer {
            background-color: #FFFFFF;
            border-top: 1px solid #E5E7EB;
            padding: 1rem;
            position: sticky;
            bottom: 0;
            z-index: 10;
        }

        .input-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background-color: #F3F4F6;
            border-radius: 2rem;
            padding: 0.5rem 1rem;
        }

        input[type="text"] {
            flex: 1;
            background: none;
            border: none;
            outline: none;
            font-size: 1rem;
            color: #374151;
            padding: 0.5rem 0;
        }

        input[type="text"]::placeholder {
            color: #9CA3AF;
        }

        .send-btn {
            background-color: #556B2F;
            color: #FFFFFF;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .send-btn:hover {
            background-color: #445A25;
        }

        nav {
            background-color: #FDFBF7;
            border-top: 1px solid #E5E7EB;
            padding: 0.5rem 0;
            display: flex;
            justify-content: space-around;
        }

        nav a {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            text-decoration: none;
            color: #6B7280;
            font-size: 0.75rem;
            font-weight: 500;
            transition: color 0.2s;
        }

        nav a.active {
            color: #556B2F;
        }

        nav a:hover {
            color: #556B2F;
        }

        .typing-indicator {
            display: none;
            padding: 0.5rem 1rem;
            background-color: #FFFFFF;
            border-radius: 1.2rem;
            margin-left: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            margin: 0 2px;
            background-color: #9CA3AF;
            border-radius: 50%;
            display: inline-block;
            animation: typing 1.4s infinite both;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0% { transform: scale(0); }
            50% { transform: scale(1); }
            100% { transform: scale(0); }
        }

        @media (max-width: 600px) {
            header h1 {
                font-size: 1.1rem;
            }

            .message-content {
                max-width: 60%;
            }

            .avatar {
                width: 2rem;
                height: 2rem;
                font-size: 1rem;
            }

            input[type="text"] {
                font-size: 0.9rem;
            }

            .message-bubble {
                padding: 0.6rem 0.9rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="back-btn">
                <span class="material-symbols-outlined">arrow_back_ios</span>
            </button>
            <h1>Mahdawiyyah Chat</h1>
        </header>
        <main id="chat-container">
        </main>
        <footer>
            <div class="input-container">
                <input type="text" id="message-input" placeholder="Type a message...">
                <button class="send-btn" id="send-button">
                    <span class="material-symbols-outlined">send</span>
                </button>
            </div>
            <nav>
                <a href="#" class="active">
                    <span class="material-symbols-outlined">chat</span>
                    <span>Chat</span>
                </a>
                <a href="#">
                    <span class="material-symbols-outlined">settings</span>
                    <span>Settings</span>
                </a>
                <a href="#">
                    <span class="material-symbols-outlined">person</span>
                    <span>Profile</span>
                </a>
            </nav>
        </footer>
    </div>
    <script>
        const apiKey = 'AIzaSyCmWUv29gyH3cKrVzFqmOEL-iP-Y63vtv8';
        // Updated system instruction with Hausa as default but multilingual support
        const systemInstruction = {
            text: `You are Mahdawiyyah, a knowledgeable and respectful AI assistant specialized in Mahdism, Mahdawiyyah, and all matters related to Imam Mahdi (AS). 
            Provide accurate, informative responses based on Islamic teachings, hadiths, Quranic verses, and reliable scholarly sources. 
            Always respond politely, helpfully, and in a manner that promotes understanding. 
            If a question is unrelated, gently redirect the conversation to topics on Imam Mahdi, Mahdism, or Mahdawiyyah. 
            You are multilingual and can communicate in various languages. Always respond in the same language as the user's query.
            Your default language is Hausa, but you should respond in whatever language the user uses.
            Begin interactions with an appropriate greeting in Hausa.`
        };
        
        let conversation = [
            { role: "user", parts: [systemInstruction] },
            { role: "model", parts: [{ text: "Assalamu alaikum wa rahmatullah. Ni ne Mahdawiyyah AI, ina taimakawa da duk wata tambaya game da Mahdism, Mahdawiyyah, da Imam Mahdi (AS) a cikin kowane harshe. Yaya zan iya taimaka muku a yau?" }] }
        ];
        
        const chatContainer = document.getElementById('chat-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        
        function appendMessage(sender, message) {
            const isUser = sender === 'user';
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
        
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'avatar';
            
            const iconSpan = document.createElement('span');
            iconSpan.className = 'material-symbols-outlined';
            iconSpan.textContent = isUser ? 'person' : 'smart_toy';
            avatarDiv.appendChild(iconSpan);
        
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
        
            const nameP = document.createElement('p');
            nameP.className = 'sender';
            nameP.textContent = isUser ? 'You' : 'Mahdawiyyah';
            contentDiv.appendChild(nameP);
        
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            
            // Handle line breaks in the message
            const messageLines = message.split('\n');
            messageLines.forEach((line, index) => {
                if (index > 0) {
                    bubbleDiv.appendChild(document.createElement('br'));
                }
                bubbleDiv.appendChild(document.createTextNode(line));
            });
            
            contentDiv.appendChild(bubbleDiv);
        
            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(contentDiv);
        
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        function showTypingIndicator() {
            const indicatorDiv = document.createElement('div');
            indicatorDiv.id = 'typing-indicator';
            indicatorDiv.className = 'message bot typing-indicator';
            indicatorDiv.style.display = 'flex';
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'avatar';
            
            const iconSpan = document.createElement('span');
            iconSpan.className = 'material-symbols-outlined';
            iconSpan.textContent = 'smart_toy';
            avatarDiv.appendChild(iconSpan);
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            
            const nameP = document.createElement('p');
            nameP.className = 'sender';
            nameP.textContent = 'Mahdawiyyah';
            contentDiv.appendChild(nameP);
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.innerHTML = '<span></span><span></span><span></span>';
            
            contentDiv.appendChild(bubbleDiv);
            indicatorDiv.appendChild(avatarDiv);
            indicatorDiv.appendChild(contentDiv);
            
            chatContainer.appendChild(indicatorDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            return indicatorDiv;
        }
        
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            appendMessage('user', message);
            messageInput.value = '';
            
            const userMessage = {
                role: "user", 
                parts: [{ text: message }]
            };
            
            conversation.push(userMessage);
            
            // Show typing indicator
            const typingIndicator = showTypingIndicator();
        
            try {
                // Use Gemini 2.0 Flash for faster responses (Pro might be too slow for chat)
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        contents: conversation,
                        generationConfig: {
                            // Let the model automatically detect and respond in the user's language
                        }
                    })
                });
                
                // Remove typing indicator
                if (typingIndicator && typingIndicator.parentNode) {
                    chatContainer.removeChild(typingIndicator);
                }
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error:', response.status, errorText);
                    throw new Error(`API request failed: ${response.status}`);
                }
                
                const data = await response.json();
                if (!data.candidates || !data.candidates[0].content.parts[0].text) {
                    console.error('Invalid API response:', data);
                    throw new Error('Invalid response from API');
                }
                
                const reply = data.candidates[0].content.parts[0].text.trim();
                appendMessage('bot', reply);
                conversation.push({ role: "model", parts: [{ text: reply }] });
            } catch (error) {
                console.error('Error:', error.message);
                appendMessage('bot', 'Sorry, there was an error processing your request. Please check your internet connection or try again later.');
            }
        }
        
        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Display initial greeting in Hausa
        setTimeout(() => {
            appendMessage('bot', conversation[1].parts[0].text);
        }, 1000);
    </script>
</body>
</html>
